*[
  _type == "product"
  && !(defined(hidden) && hidden)
  && ($target == master.id || $target in variants[].id)
]